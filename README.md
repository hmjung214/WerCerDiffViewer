# WER/CER Diff Web Viewer (REF vs HYP)

전사문(Reference, **REF**) 1개와 STT 결과(Hypothesis, **HYP**) 여러 개를 업로드하면,
파일별 **WER/CER**를 계산하고 **REF vs HYP 차이(diff)** 를 색상으로 하이라이트해 보여주는 단일 HTML 웹 뷰어입니다.

* 서버 없이 **브라우저에서 바로 실행(로컬 파일 1개)**
* 결과 표에서 파일 선택 → **세로(행 단위) 비교**로 읽기 쉽게 표시
* OK/SUB/DEL/INS를 색상으로 구분

---

## 기능

### 1) 파일별 지표 계산

* **WER(단어 기준)**: (Substitution + Insertion + Deletion) / #REF words
* **CER(문자 기준)**: (Substitution + Insertion + Deletion) / #REF chars
* 함께 표시되는 카운트

  * **S**: 치환(Substitution)
  * **I**: 삽입(Insertion)
  * **D**: 삭제(Deletion)
  * **H**: 정답(Hit)

### 2) Diff(맞음/틀림) 시각화

* 기본: **세로(추천)**

  * 컬럼: `idx | REF | HYP`
  * 한 행이 토큰 1개(또는 문자 1개)의 정렬 결과
* 옵션:

  * **보기 방식**: 세로 / 가로(기존)
  * **정답 숨김**: OK 항목을 숨기고 오류만 보기
  * **오류 주변**: 오류가 있는 토큰 주변만 표시(긴 문서 성능 보호)
  * **전체 표시**: 전체를 모두 렌더링(긴 문서에서 느려질 수 있음)

### 3) 정규화(Normalization)

브라우저에서 아래 규칙으로 REF/HYP 모두 동일하게 정규화합니다.

* Unicode NFC 정규화
* `[ ... ]` 형태의 타임태그 제거
* `\r`, `\t`, BOM 제거
* 줄바꿈 `\n` → 공백으로 변환
* 연속 공백 정리(단일 공백), 양끝 trim

> 주의: 구두점/숫자/의미 기반 정규화는 하지 않습니다.

---

## 파일 구성

* `index.html` (단일 파일)

  * HTML/CSS/JS가 모두 포함된 실행 파일

---

## 실행 방법

1. `wer_viewer.html` 파일을 생성하고 코드를 저장합니다.
2. 크롬/엣지에서 파일을 더블클릭하여 실행합니다.
3. **레퍼런스(REF) 파일 1개** 업로드
4. **가설(HYP) 파일 여러 개** 업로드
5. **계산하기** 클릭
6. 표에서 원하는 파일 행을 클릭하면 하단에 diff가 표시됩니다.

---

## 사용 팁

### 1) 세로 비교가 기본(추천)

가로 비교는 토큰이 많으면 가독성이 떨어집니다.
**보기 방식 → 세로(추천)** 로 두고 보세요.

### 2) 긴 문서에서 느릴 때

* `정답 숨김`을 켜고(오류만 표시)
* `오류 주변` 값을 6~15 정도로 조절
* `전체 표시`는 가급적 끄는 것을 추천

### 3) CER(문자 비교) 길이 제한

문자 단위(CER)는 토큰 수가 매우 커서 브라우저가 느려질 수 있습니다.
기본 코드에서는 `CHAR_LIMIT = 12000` 이상일 때 CER 계산/표시를 스킵합니다.

* 더 길게 보고 싶으면 HTML 파일에서 아래 값을 조절하세요.

```js
const CHAR_LIMIT = 12000; // 필요하면 늘리기
```

---

## 출력 색상 의미

* **OK (정답)**: 녹색 계열
* **SUB (치환)**: 붉은 계열
* **DEL (삭제)**: 노란 계열
* **INS (삽입)**: 파란 계열
* `∅` : 해당 위치에 토큰이 없음(예: 삭제/삽입으로 인해 한쪽이 비는 경우)

---

## 한계 / 주의사항

* 이 뷰어는 브라우저에서 동작하는 단순 구현이라,

  * 매우 긴 텍스트(특히 CER)에서는 성능 문제가 있을 수 있습니다.
* WER/CER 계산 로직은 “정렬 기반”이며, 실제 STT 평가 정책(띄어쓰기/기호 처리 등)에 따라 결과가 달라질 수 있습니다.

---

## 개선 아이디어(원하면 추가 가능)

* 오류 유형별(S/I/D) 필터
* 특정 단어 검색 후 해당 구간으로 점프
* “WER 최악 Top N” 자동 diff 출력
* CSV 다운로드 버튼(결과 저장)

